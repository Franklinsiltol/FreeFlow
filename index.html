<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeFlow</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            color: black;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .navbar {
            width: 100%;
            height: 60px;
            background-color: white;
            border-bottom: 5px solid black;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            flex-shrink: 0;
            box-sizing: border-box;
        }

        .navbar .logo {
            font-size: 24px;
            font-weight: bold;
            color: black;
        }

        .search-bar input[type="text"] {
            width: 200px;
            padding: 5px;
            border: 2px solid black;
            border-radius: 4px;
        }

        .navbar .sidebar {
            display: flex;
            align-items: center;
        }

        .navbar .sidebar a {
            color: black;
            text-decoration: none;
            margin: 0 10px;
            font-size: 24px;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            padding-bottom: 60px; /* Para evitar sobreposição com a caixa de postagem */
        }

        .post-feed {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .post {
            width: 100%;
            max-width: 800px;
            border: 3px solid black;
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
        }

        .post-actions {
            margin-top: 10px;
        }

        .post-actions button {
            margin-right: 10px;
            padding: 5px 10px;
            border: 2px solid black;
            background-color: white;
            color: black;
            cursor: pointer;
        }

        .post-actions button:hover {
            background-color: black;
            color: white;
        }

        .post-box-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            border-top: 5px solid black;
            padding: 10px;
            box-sizing: border-box;
            display: none; /* Inicialmente escondido */
            z-index: 1000; /* Certifica que a caixa de postagem esteja sobre os posts */
        }

        .post-box {
            width: 100%;
            display: flex;
            flex-direction: column;
            background-color: white;
        }

        .post-box textarea {
            width: calc(100% - 20px);
            padding: 10px;
            font-size: 16px;
            border: 2px solid black;
            margin-bottom: 10px;
            resize: none;
        }

        .post-box .upload-icon {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .post-box .upload-icon i {
            font-size: 24px;
            color: black;
            margin-right: 10px;
        }

        .post-box input[type="file"] {
            display: none;
        }

        .post-box button {
            padding: 10px;
            background-color: black;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }

        .footer {
            width: 100%;
            height: 50px;
            background-color: white;
            border-top: 5px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            bottom: 0;
            left: 0;
            flex-shrink: 0;
            box-sizing: border-box;
        }

        .footer p {
            margin: 0;
            font-size: 14px;
        }

        .floating-button {
            position: fixed;
            bottom: 70px;
            right: 20px;
            background-color: black;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
        }

        .back-to-top {
            position: fixed;
            bottom: 120px;
            right: 20px;
            background-color: black;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: none; /* Inicialmente escondido */
            z-index: 1000;
        }

        /* Responsiveness */
        @media (max-width: 768px) {
            .navbar {
                padding: 0 10px;
            }

            .search-bar input[type="text"] {
                width: 150px;
            }

            .navbar .sidebar a {
                margin: 0 5px;
                font-size: 20px;
            }

            .main-content {
                padding: 10px;
            }

            .post-box-container {
                bottom: 70px;
            }

            .floating-button {
                bottom: 80px;
            }

            .back-to-top {
                bottom: 90px;
            }
        }

        @media (max-width: 480px) {
            .navbar {
                height: 50px;
            }

            .navbar .logo {
                font-size: 18px;
            }

            .search-bar input[type="text"] {
                width: 120px;
            }

            .navbar .sidebar a {
                font-size: 18px;
            }

            .main-content {
                padding: 5px;
            }

            .post-box textarea {
                width: calc(100% - 14px);
                font-size: 14px;
            }

            .post-box button {
                padding: 8px;
                font-size: 14px;
            }

            .floating-button {
                padding: 10px;
                font-size: 20px;
            }

            .back-to-top {
                padding: 8px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="logo">FreeFlow</div>
        <div class="search-bar">
            <input type="text" placeholder="Buscar...">
        </div>
        <div class="sidebar">
            <a href="#"><i class="fas fa-home"></i></a>
            <a href="#"><i class="fas fa-user"></i></a>
            <a href="#"><i class="fas fa-bell"></i></a>
        </div>
    </div>

    <div class="main-content">
        <div class="post-feed" id="postFeed">
            <!-- Posts adicionados dinamicamente aparecerão aqui -->
        </div>
    </div>

    <!-- Caixa de postagem inicial escondida -->
    <div class="post-box-container" id="postBoxContainer">
        <div class="post-box">
            <textarea id="postContent" placeholder="O que você está pensando?" rows="2"></textarea>
            <label class="upload-icon" for="postImage">
                <i class="fas fa-camera"></i> <!-- Ícone da câmera fotográfica -->
                <span>Adicionar Foto</span>
            </label>
            <input type="file" id="postImage" accept="image/*">
            <button onclick="addPost()">Publicar</button>
        </div>
    </div>

    <!-- Botão flutuante para abrir a caixa de postagem -->
    <button class="floating-button" onclick="togglePostBox()">
        <i class="fas fa-pencil-alt"></i>
    </button>

    <!-- Botão "Voltar ao Topo" -->
    <button class="back-to-top" onclick="scrollToTop()">
        <i class="fas fa-chevron-up"></i>
    </button>

    <div class="footer">
        <p>&copy; 2024 FreeFlow. Todos os direitos reservados.</p>
    </div>

    <script>
        // Configuração do IndexedDB
        const dbName = 'freeFlowDB';
        const storeName = 'posts';
        let db;

        function openDatabase() {
            const request = indexedDB.open(dbName, 1);

            request.onupgradeneeded = function(event) {
                db = event.target.result;
                if (!db.objectStoreNames.contains(storeName)) {
                    db.createObjectStore(storeName, { keyPath: 'id', autoIncrement: true });
                }
            };

            request.onsuccess = function(event) {
                db = event.target.result;
                loadPosts(); // Carregar posts ao abrir o banco de dados
            };

            request.onerror = function(event) {
                console.error('Erro ao abrir o banco de dados:', event.target.errorCode);
            };
        }

        function addPostToDB(post) {
            const transaction = db.transaction([storeName], 'readwrite');
            const store = transaction.objectStore(storeName);
            const request = store.add(post);

            request.onsuccess = function() {
                console.log('Post adicionado com sucesso ao banco de dados');
            };

            request.onerror = function(event) {
                console.error('Erro ao adicionar post ao banco de dados:', event.target.errorCode);
            };
        }

        function getPostsFromDB(callback) {
            const transaction = db.transaction([storeName], 'readonly');
            const store = transaction.objectStore(storeName);
            const request = store.getAll();

            request.onsuccess = function(event) {
                callback(event.target.result);
            };

            request.onerror = function(event) {
                console.error('Erro ao recuperar posts do banco de dados:', event.target.errorCode);
            };
        }

        function addPost() {
            var postContent = document.getElementById('postContent').value;
            var postImage = document.getElementById('postImage').files[0];

            if (postContent.trim() === '' && !postImage) {
                alert('Por favor, insira algum texto ou selecione uma imagem.');
                return;
            }

            var post = {
                content: postContent,
                image: postImage ? URL.createObjectURL(postImage) : null,
                timestamp: new Date().toISOString()
            };

            var postFeed = document.getElementById('postFeed');

            var postDiv = document.createElement('div');
            postDiv.className = 'post';

            if (post.content) {
                var postText = document.createElement('p');
                postText.textContent = post.content;
                postDiv.appendChild(postText);
            }

            if (post.image) {
                var postImageElement = document.createElement('img');
                postImageElement.src = post.image;
                postImageElement.style.maxWidth = '100%';
                postImageElement.style.marginTop = '10px';
                postDiv.appendChild(postImageElement);
            }

            var postActions = document.createElement('div');
            postActions.className = 'post-actions';

            var likeButton = document.createElement('button');
            likeButton.innerText = 'Aplaudir';
            postActions.appendChild(likeButton);

            var commentButton = document.createElement('button');
            commentButton.innerText = 'Expressar';
            postActions.appendChild(commentButton);

            var pinButton = document.createElement('button');
            pinButton.innerText = 'Tornar memorável';
            pinButton.onclick = function() {
                postFeed.insertBefore(postDiv, postFeed.firstChild);
            };
            postActions.appendChild(pinButton);

            postDiv.appendChild(postActions);

            postFeed.insertBefore(postDiv, postFeed.firstChild);

            // Adiciona o post ao IndexedDB
            addPostToDB(post);

            document.getElementById('postContent').value = '';
            document.getElementById('postImage').value = '';

            togglePostBox(); // Esconde a caixa de postagem após a publicação
        }

        function loadPosts() {
            getPostsFromDB(function(posts) {
                var postFeed = document.getElementById('postFeed');
                postFeed.innerHTML = ''; // Limpa posts existentes

                posts.forEach(function(post) {
                    var postDiv = document.createElement('div');
                    postDiv.className = 'post';

                    if (post.content) {
                        var postText = document.createElement('p');
                        postText.textContent = post.content;
                        postDiv.appendChild(postText);
                    }

                    if (post.image) {
                        var postImageElement = document.createElement('img');
                        postImageElement.src = post.image;
                        postImageElement.style.maxWidth = '100%';
                        postImageElement.style.marginTop = '10px';
                        postDiv.appendChild(postImageElement);
                    }

                    var postActions = document.createElement('div');
                    postActions.className = 'post-actions';

                    var likeButton = document.createElement('button');
                    likeButton.innerText = 'Aplaudir';
                    postActions.appendChild(likeButton);

                    var commentButton = document.createElement('button');
                    commentButton.innerText = 'Expressar';
                    postActions.appendChild(commentButton);

                    var pinButton = document.createElement('button');
                    pinButton.innerText = 'Tornar memorável';
                    pinButton.onclick = function() {
                        postFeed.insertBefore(postDiv, postFeed.firstChild);
                    };
                    postActions.appendChild(pinButton);

                    postDiv.appendChild(postActions);

                    postFeed.insertBefore(postDiv, postFeed.firstChild);
                });
            });
        }

        function togglePostBox() {
            var postBoxContainer = document.getElementById('postBoxContainer');
            if (postBoxContainer.style.display === 'none' || postBoxContainer.style.display === '') {
                postBoxContainer.style.display = 'block';
            } else {
                postBoxContainer.style.display = 'none';
            }
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.addEventListener('DOMContentLoaded', function() {
            openDatabase();
        });
    </script>
</body>
</html>
